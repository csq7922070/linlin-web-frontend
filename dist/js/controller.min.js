skhControllers.controller("accountCtrl",["$scope","$http","$stateParams","$rootScope","$state",function(e,t,o,s,n){e.ownerName=o.username,e.floor=o.floor,e.unit=o.unit,e.room=o.room,e.id=o.id,console.log(o.id),t({method:"GET",url:basePath+"/payment/getAmount.do",params:{paymentState:0,id:o.id}}).success(function(t){if(""!=t){e.freeShow=!1;var o=t.amountList,n={};n.datas=new Array;for(var r=0;r<o.length;r++){var a=o[r].year+"年"+o[r].month+"月",i={};if(i.id=o[r].id,i.type=o[r].paymentType,i.amount=o[r].amount,n.datas.length>0){for(var c=0;c<n.datas.length;c++)if(n.datas[c].yearmonth==a){n.datas[c].eles.push(i);break}if(c==n.datas.length){var t={};t.yearmonth=a,t.eles=new Array,t.eles.push(i),n.datas.push(t)}}else{var t={};t.yearmonth=a,t.eles=new Array,t.eles.push(i),n.datas.push(t)}}e.payments=n.datas,e.selectAll=function(){},e.selected=[],e.total=0,e.update=function(t){if(t.selected)-1==e.selected.indexOf(t.id)&&(e.selected.push(t.id),e.total+=t.amount);else if(-1!=e.selected.indexOf(t.id)){var n=e.selected.indexOf(t.id);e.selected.splice(n,1),e.total-=t.amount}for(var r=0,a=0,i=[],c=[],l=e.selected,u=o,d=0;d<u.length;d++)for(var m=0;m<l.length;m++)u[d].id==l[m]&&(0==u[d].paymentType?(r+=u[d].amount,i.push(u[d].month)):(a+=u[d].amount,c.push(u[d].month)));s.waterFree=r,s.eleFree=a,s.wmonth=i,s.emonth=c},e.updateYearmonth=function(t,n){for(var r=0;r<e.payments.length;r++)if(e.payments[r].yearmonth==t){for(var a=0;a<e.payments[r].eles.length;a++){var i=e.payments[r].eles[a];if(n)-1==e.selected.indexOf(i.id)&&(e.selected.push(i.id),e.total+=i.amount,i.selected=!0);else if(-1!=e.selected.indexOf(i.id)){var c=e.selected.indexOf(i.id);e.selected.splice(c,1),e.total-=i.amount,i.selected=!1}}break}for(var l=0,u=0,d=e.selected,m=[],p=[],h=o,r=0;r<h.length;r++)for(var a=0;a<d.length;a++)h[r].id==d[a]&&(0==h[r].paymentType?(l+=h[r].amount,m.push(h[r].month)):(u+=h[r].amount,p.push(h[r].month)));s.waterFree=l,s.eleFree=u,s.wmonth=m,s.emonth=p},e.updateAll=function(t){angular.forEach(e.payments,function(o){o.selected=t,angular.forEach(o.eles,function(o){if(t)-1==e.selected.indexOf(o.id)&&(e.selected.push(o.id),e.total+=o.amount,o.selected=!0);else if(-1!=e.selected.indexOf(o.id)){var s=e.selected.indexOf(o.id);e.selected.splice(s,1),e.total-=o.amount,o.selected=!1}})});for(var n=0,r=0,a=e.selected,i=[],c=[],l=o,u=0;u<l.length;u++)for(var d=0;d<a.length;d++)l[u].id==a[d]&&(0==l[u].paymentType?(n+=l[u].amount,i.push(l[u].month)):(r+=l[u].amount,c.push(l[u].month)));s.waterFree=n,s.eleFree=r,s.wmonth=i,s.emonth=c}}}).error(function(e){console.log("数据")})}]),skhControllers.controller("accountRecordCtrl",["$scope","$http","$stateParams","$rootScope","$state",function(e,t,o,s,n){e.records={amountList:[{id:4,year:"2015",month:12,amount:35.99,paymentType:"1",number:"3456°-1246°",count:"-2210°"},{id:5,year:"2015",month:11,amount:4.11,paymentType:"0",number:"0m³-3456m³",count:"3456m³"}],amountSum:"444.00"}}]),skhControllers.controller("addressCtrl",["$scope","$http","$stateParams","$rootScope",function(e,t,o,s){e.add_newaddress=function(){t({method:"POST",url:basePath+"/archives/addHouse",data:{court:"阿尔卡迪亚",floor:o.floor,unit:o.unit,roomNo:o.room,openid:sessionStorage.getItem("openid"),id:o.id,initial:o.initial}}).success(function(e){console.log("后台添加地址成功")}).error(function(e){console.log("后台添加地址成功")})},console.log("floor"+o.floor+" unit"+o.unit+" room"+o.room),console.log("succees"),e.floor=o.floor,e.unit=o.unit,e.room=o.room,e.username=o.username,e.id=o.id,console.log("username:"+e.username+" id:"+e.id),console.log(o.initial)}]),skhControllers.controller("addressFloorCtrl",["$scope","$http","$stateParams","$rootScope",function(e,t,o,s){t({method:"GET",url:basePath+"/archives/getFloor.do"}).success(function(t){e.datas=t})}]),skhControllers.controller("addressRoomCtrl",["$scope","$http","$stateParams","$rootScope","$state",function(e,t,o,s,n){t({method:"GET",url:basePath+"/archives/getRoom.do",params:{floor:o.floor,unit:o.unit}}).success(function(t){e.floor=o.floor,e.unit=o.unit,e.rooms=t.items})}]),skhControllers.controller("addressUnitCtrl",["$scope","$http","$stateParams","$rootScope","$state",function(e,t,o,s,n){t({method:"GET",url:basePath+"/archives/getUnit.do",params:{floor:o.floor}}).success(function(t){e.units=t.items,e.floor=o.floor})}]),skhControllers.controller("complainAddCtrl",["$scope","$http","$timeout","$state",function(e,t,o,s){e.suc_show=!1,e.err_show=!1,e.submitForm=function(){t({method:"POST",url:basePath+"/complain/add.do",data:{title:e.title,mobile:e.mobile,content:e.content,openid:sessionStorage.getItem("openid")}}).success(function(t){e.suc_show=!0,o(function(){e.suc_show=!1,s.go("complain")},3e3)}).error(function(t){e.err_show=!0,o(function(){e.err_show=!1},3e3)})}}]),skhControllers.controller("complainDetailCtrl",["$scope","$http","$stateParams",function(e,t,o){t({method:"GET",url:basePath+"/complain/get.do",params:{id:o.id}}).success(function(t){e.complain=t})}]),skhControllers.controller("complainListCtrl",["$scope","$http",function(e,t){e.currentPage=0,e.pageSize=10,e.load=function(o,s){o>e.numberOfPages||e.currentPage==o||1>o||e.busy||(e.busy=!0,t({method:"GET",url:basePath+"/complain/getByOpenid",params:{offset:e.pageSize*(o-1),limit:e.pageSize,openid:sessionStorage.getItem("openid")}}).success(function(t){e.numberOfPages=Math.ceil(t.count/e.pageSize),e.currentPage=o,e.busy=!1,e.complains=t.items}))},e.load(1,e.pageSize)}]),skhControllers.controller("homeCtrl",["$scope","$http","$stateParams","$rootScope","$state","$location",function(e,t,o,s,n,r){var a=r.url().substring(r.url().indexOf("?"));-1!=a.indexOf("home")&&(a=""),t({method:"GET",url:basePath+"/getopenid"+a}).success(function(e){sessionStorage.setItem("openid",e.openid),console.log("获取openid成功")}).error(function(e){console.log("获取openid失败")}),e.slides7=[{id:10,label:"slide #1",img:"images/banner_01.png"},{id:11,label:"slide #2",img:"images/banner_02.png"},{id:12,label:"slide #3",img:"images/banner_03.png"}],e.carouselIndex7=0,s.site=1,n.go("home.shop-info",{site:1})}]),skhControllers.controller("noticeDetailCtrl",["$scope","$http","$stateParams",function(e,t,o){t({method:"GET",url:basePath+"/notice/get.do",params:{id:o.id}}).success(function(t){e.notice=t})}]),skhControllers.controller("noticeListCtrl",["$scope","$http",function(e,t){e.currentPage=0,e.pageSize=10,e.load=function(o,s){o>e.numberOfPages||e.currentPage==o||1>o||e.busy||(e.busy=!0,t({method:"GET",url:basePath+"/notice/list.do",params:{offset:e.pageSize*(o-1),limit:e.pageSize,openid:sessionStorage.getItem("openid")}}).success(function(t){e.numberOfPages=Math.ceil(t.count/e.pageSize),e.currentPage=o,e.busy=!1,e.notices=t.items}))},e.load(1,e.pageSize)}]),skhControllers.controller("ownerCtrl",["$scope","$http","$stateParams","$rootScope","$state",function(e,t,o,s,n){t({method:"GET",url:basePath+"/archives/findHouseByOpenid",params:{openid:sessionStorage.getItem("openid")}}).success(function(o){""!=o&&(e.houses=o.items,o.items.forEach(function(o){0==o.active&&(e.activeId=o.id),o.deleteAddress=function(s){e.sure_delete=!0,e.sure=function(){e.sure_delete=!1,t({method:"POST",url:basePath+"/archives/delHouse",data:{id:o.id}}).success(function(t){e.houses.splice(s,1),console.log("删除成功")}).error(function(e){console.log("删除失败")})},e.cancel=function(){e.sure_delete=!1}},o.change_flag=function(){0!=o.active&&t({method:"POST",url:basePath+"/archives/updateHouseActive",data:{id:o.id,openid:sessionStorage.getItem("openid")}}).success(function(t){e.activeId=o.id,console.log("设置默认地址成功")}).error(function(e){console.log("设置默认地址失败")})}}))}).error(function(e){})}]),skhControllers.controller("paymentCtrl",["$scope","$http","$stateParams","$rootScope","$state",function(e,t,o,s,n){e.watmonth_f=s.wmonth,e.watmonth=e.watmonth_f.join(","),e.elmonth_f=s.emonth,e.elmonth=e.elmonth_f.join(","),e.floor=s.floor,e.unit=s.unit,e.room=s.room,e.waterFr=s.waterFree,e.eleFr=s.eleFree,e.totalFee=s.waterFree+s.eleFree,e.money_payment=function(){console.log("支付功能开始"),t({method:"GET",url:basePath+"/payment/webchatPay",params:{total_fee:e.totalFee,openid:sessionStorage.getItem("openid")}}).error(function(e,t,o,s){self.error="连接错误!"}).then(function(e){return"FAIL"==e.data.return_code?(self.error=e.data.return_msg,$q.reject()):$q.resolve({appid:e.data.appid,prepay_id:e.data.prepay_id,timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,paySign:e.data.sign,timestamp:e.data.timestamp})}).then(function(e){var t=$q.defer();return wx.config({debug:!0,appId:e.appid,timestamp:sessionStorage.getItem("timestamp"),nonceStr:sessionStorage.getItem("noncestr"),signature:sessionStorage.getItem("sign"),jsApiList:["chooseWXPay"]}),wx.chooseWXPay({timestamp:e.timestamp,nonceStr:e.nonceStr,"package":e.prepay_id,signType:"MD5",paySign:e.paySign,success:function(e){console.log("successfully paid",e),t.resolve("success")}}),t.promise}).then(function(){return n.go("success"),$q.resolve(!0)})}}]),skhControllers.controller("repairAddCtrl",["$scope","$http","$timeout","$state",function(e,t,o,s){e.submitForm=function(){t({method:"POST",url:basePath+"/repair/add.do",data:{device:e.device,remark:e.remark,mobile:e.mobile,unit:e.unit,roomNo:e.roomNo,floor:e.floor,openid:sessionStorage.getItem("openid")}}).success(function(t){e.suc_show=!0,o(function(){e.suc_show=!1,s.go("repair")},3e3)}).error(function(t){e.err_show=!0,o(function(){e.err_show=!1},3e3)})}}]),skhControllers.controller("repairDetailCtrl",["$scope","$http","$stateParams","$timeout",function(e,t,o,s){e.suc_show=!1,e.err_show=!1,t({method:"GET",url:basePath+"/repair/get.do",params:{id:o.id}}).success(function(o){e.repair=o,e.repair.confirm=function(){t({method:"POST",url:basePath+"/repair/confirm.do",data:{id:e.repair.id}}).success(function(t){e.suc_show=!0,s(function(){e.suc_show=!1},3e3)}).error(function(t){e.err_show=!0,s(function(){e.err_show=!1},3e3)})}})}]),skhControllers.controller("repairListCtrl",["$scope","$http","$timeout",function(e,t,o){e.currentPage=0,e.pageSize=10,e.suc_show=!1,e.err_show=!1,e.repairs=[],e.load=function(s,n){s>e.numberOfPages||e.currentPage==s||1>s||e.busy||(e.busy=!0,t({method:"GET",url:basePath+"/repair/list.do",params:{offset:e.pageSize*(s-1),limit:e.pageSize,openid:sessionStorage.getItem("openid")}}).success(function(n){e.numberOfPages=Math.ceil(n.count/e.pageSize),e.currentPage=s,e.busy=!1,n.items.forEach(function(s){e.repairs.push(s),s.confirm=function(){t({method:"POST",url:basePath+"/repair/finish.do",data:{id:s.id}}).success(function(t){e.suc_show=!0,o(function(){e.suc_show=!1},3e3)}).error(function(t){e.err_show=!0,o(function(){e.err_show=!1},3e3)})}})}))},e.load(1,e.pageSize)}]),skhControllers.controller("shopInfoCtrl",["$scope","$http","$stateParams","$rootScope","$state",function(e,t,o,s,n){s.site=o.site,e.currentPage=0,e.pageSize=5,e.shops=[],e.load=function(n,r){n>e.numberOfPages||e.currentPage==n||1>n||e.busy||3!=s.site&&(e.busy=!0,t({method:"GET",url:basePath+"/getBusiness.do",params:{offset:e.pageSize*(n-1),limit:8==r?r:e.pageSize,type:o.site-1}}).success(function(t){e.numberOfPages=Math.ceil(t.count/e.pageSize),e.currentPage=n,e.busy=!1,e.shops.push.apply(e.shops,t.items)}).error(function(e){}))},e.load(1,8)}]);